= Event-Driven Certificate Revocation Lab
:author: Chris Zinda
:toc:
:icons: font

== Overview

This AgnosticD config deploys a full *Event-Driven Certificate Revocation Lab* onto a single AWS EC2 instance via the Red Hat Demo Platform (RHPDS).

The lab demonstrates automated certificate lifecycle management in a Zero Trust Architecture using three independent PKI hierarchies:

* *RSA-4096* — Traditional cryptography (SHA-512 signatures)
* *ECC P-384* — Elliptic Curve Cryptography (ECDSA with SHA-384)
* *ML-DSA-87* — Post-Quantum Cryptography (NIST FIPS 204 Level 5)

=== Architecture

[source]
----
Mock EDR/SIEM → Kafka (security-events) → EDA Rulebook → Ansible Playbook → Dogtag PKI Revocation
----

The lab deploys ~25 containers including:

* *Dogtag PKI* — 3 CA hierarchies (Root → Intermediate → IoT/EST/ACME Sub-CAs)
* *Kafka + Zookeeper* — Event streaming
* *Event-Driven Ansible* — Rulebook engine consuming Kafka events
* *AWX* — Ansible automation platform
* *Mock EDR / SIEM* — FastAPI security event simulators (26 attack scenarios)
* *IoT Client* — EST enrollment simulator
* *Prometheus + Grafana* — PKI performance monitoring
* *Jupyter Lab* — Interactive notebooks

== Prerequisites

* RHPDS account with AgnosticD access
* AWS credentials configured
* RHEL 10 AMI available in target region

== Deployment

[source,bash]
----
# Copy and customize variables
cp sample_vars.yml my_vars.yml
vi my_vars.yml

# Deploy via AgnosticD
ansible-playbook main.yml -e @my_vars.yml
----

=== Configuration Options

[cols="2,1,3", options="header"]
|===
| Variable | Default | Description

| `cert_lab_pki_mode`
| `all`
| PKI types to deploy: `rsa`, `ecc`, `pqc`, `dual`, `all`

| `cert_lab_deploy_freeipa`
| `false`
| Deploy FreeIPA identity management

| `aws_instance_type`
| `m5.4xlarge`
| EC2 instance type (16 vCPU, 64 GB RAM)

| `cert_lab_repo_branch`
| `main`
| Git branch to deploy

| `cert_lab_admin_password`
| _(auto-generated)_
| Admin password for AWX, Grafana, etc.

| `cert_lab_pki_admin_password`
| _(auto-generated)_
| Dogtag PKI admin password
|===

== Service URLs

After deployment, all services are accessible via the EC2 public hostname:

[cols="2,1,2", options="header"]
|===
| Service | Port | URL Path

| RSA Root CA | 8443 | `/ca`
| RSA Intermediate CA | 8444 | `/ca`
| RSA IoT CA | 8445 | `/ca`
| RSA ACME CA | 8446 | `/ca`
| RSA EST CA | 8447 | `/.well-known/est/`
| ECC Root CA | 8463 | `/ca`
| ECC Intermediate CA | 8464 | `/ca`
| ECC IoT CA | 8465 | `/ca`
| ECC EST CA | 8466 | `/.well-known/est/`
| PQ Root CA | 8453 | `/ca`
| PQ Intermediate CA | 8454 | `/ca`
| PQ IoT CA | 8455 | `/ca`
| PQ EST CA | 8456 | `/.well-known/est/`
| FreeIPA | 4443 | `/ipa/ui`
| AWX | 8084 | `/`
| Mock EDR | 8082 | `/`
| Mock SIEM | 8083 | `/`
| IoT Client | 8085 | `/`
| EDA Server | 5000 | `/`
| Jupyter Lab | 8888 | `/`
| Grafana | 3000 | `/`
| Prometheus | 9090 | `/`
|===

== Quick Start (after deployment)

[source,bash]
----
# SSH into the lab host
ssh student@<hostname>

# Navigate to lab directory
cd /opt/cert-revocation-lab

# Check service status
./lab status

# List available attack scenarios
./lab scenarios

# Run an end-to-end revocation test
./lab test --pki-type rsa --scenario "Certificate Private Key Compromise"

# Run advanced test suites
./lab test-advanced --suite lifecycle --pki-type rsa

# Run bulk performance test
./lab perf-test --count 100 --pki-types rsa,ecc,pqc
----

== Teardown

[source,bash]
----
ansible-playbook destroy.yml -e @my_vars.yml
----

This runs `stop-lab.sh --clean` on the host and then destroys the EC2 instance.
